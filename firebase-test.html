<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: white;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { color: #ff6b6b; }
        .status {
            background: #0f3460;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #5568d3;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .info { color: #00bfff; }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firebase BaÄŸlantÄ± Testi</h1>
    
    <div>
        <button id="test1">1ï¸âƒ£ BaÄŸlantÄ±yÄ± Test Et</button>
        <button id="test2">2ï¸âƒ£ FotoÄŸraflarÄ± Kontrol Et</button>
        <button id="test3">3ï¸âƒ£ Test FotoÄŸrafÄ± YÃ¼kle</button>
        <button id="test4">4ï¸âƒ£ Temizle</button>
    </div>
    
    <div class="status" id="output">YÃ¼kleniyor...</div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const output = document.getElementById('output');
        
        function log(msg, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.textContent = msg;
            output.appendChild(p);
            output.scrollTop = output.scrollHeight;
        }
        
        output.innerHTML = '';
        log('ğŸš€ Sayfa yÃ¼klendi, Firebase baÅŸlatÄ±lÄ±yor...');

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAsQsyb6VebOmcI9TFsc-IIqXVYFiCwVIo",
            authDomain: "bebegim-5e848.firebaseapp.com",
            projectId: "bebegim-5e848",
            storageBucket: "bebegim-5e848.firebasestorage.app",
            messagingSenderId: "1073954837331",
            appId: "1:1073954837331:web:8fe594a86542966f2147a6"
        };

        let app, db;
        
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            log('âœ… Firebase baÅŸlatÄ±ldÄ±!', 'success');
        } catch (error) {
            log('âŒ Firebase baÅŸlatma hatasÄ±: ' + error.message, 'error');
        }

        // Test 1: BaÄŸlantÄ±yÄ± test et
        document.getElementById('test1').addEventListener('click', async () => {
            log('\nğŸ”„ Test 1: BaÄŸlantÄ± testi baÅŸlÄ±yor...');
            try {
                const testRef = doc(db, 'users/shared/test', 'connection');
                await setDoc(testRef, {
                    test: 'connection',
                    timestamp: new Date().toISOString()
                });
                log('âœ… Yazma baÅŸarÄ±lÄ±!', 'success');
                
                const docSnap = await getDoc(testRef);
                if (docSnap.exists()) {
                    log('âœ… Okuma baÅŸarÄ±lÄ±!', 'success');
                    log('ğŸ“¦ Veri: ' + JSON.stringify(docSnap.data()), 'info');
                } else {
                    log('âŒ Okuma baÅŸarÄ±sÄ±z!', 'error');
                }
            } catch (error) {
                log('âŒ Hata: ' + error.message, 'error');
            }
        });

        // Test 2: FotoÄŸraflarÄ± kontrol et
        document.getElementById('test2').addEventListener('click', async () => {
            log('\nğŸ”„ Test 2: FotoÄŸraflar kontrol ediliyor...');
            try {
                const photosRef = doc(db, 'users/shared/photos', 'list');
                const docSnap = await getDoc(photosRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    log('ğŸ“¦ Firebase\'den dÃ¶nen veri: ' + JSON.stringify(data).substring(0, 200) + '...', 'info');
                    
                    const photos = data.data || data;
                    if (Array.isArray(photos)) {
                        log(`âœ… ${photos.length} fotoÄŸraf bulundu!`, 'success');
                        photos.forEach((p, i) => {
                            log(`  ${i+1}. ${p.caption || 'Ä°simsiz'} (${p.category})`, 'info');
                        });
                    } else {
                        log('âš ï¸ Veri array deÄŸil: ' + typeof photos, 'error');
                    }
                } else {
                    log('âŒ Firebase\'de fotoÄŸraf yok!', 'error');
                    
                    // localStorage kontrol
                    const local = localStorage.getItem('lovesite_photos');
                    if (local) {
                        const photos = JSON.parse(local);
                        log(`ğŸ“‹ localStorage\'da ${photos.length} fotoÄŸraf var`, 'info');
                    } else {
                        log('ğŸ“‹ localStorage\'da da yok', 'info');
                    }
                }
            } catch (error) {
                log('âŒ Hata: ' + error.message, 'error');
            }
        });

        // Test 3: Test fotoÄŸrafÄ± yÃ¼kle
        document.getElementById('test3').addEventListener('click', async () => {
            log('\nğŸ”„ Test 3: Test fotoÄŸrafÄ± yÃ¼kleniyor...');
            try {
                const testPhoto = [{
                    id: Date.now(),
                    caption: 'Test FotoÄŸraf ' + new Date().getSeconds(),
                    category: 'moments',
                    uploadedAt: new Date().toISOString(),
                    uploadedBy: 'Test',
                    src: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzY2N2VlYSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iIGZpbGw9IndoaXRlIj5URVNUPC90ZXh0Pjwvc3ZnPg=='
                }];
                
                const photosRef = doc(db, 'users/shared/photos', 'list');
                await setDoc(photosRef, { 
                    data: testPhoto,
                    updatedAt: new Date().toISOString()
                }, { merge: true });
                
                log('âœ… Test fotoÄŸrafÄ± yÃ¼klendi!', 'success');
                log('ğŸ”„ Åimdi "2ï¸âƒ£ FotoÄŸraflarÄ± Kontrol Et" butonuna bas', 'info');
            } catch (error) {
                log('âŒ Hata: ' + error.message, 'error');
            }
        });

        // Test 4: Temizle
        document.getElementById('test4').addEventListener('click', async () => {
            if (!confirm('Firebase temizlensin mi?')) return;
            
            log('\nğŸ”„ Test 4: Firebase temizleniyor...');
            try {
                const photosRef = doc(db, 'users/shared/photos', 'list');
                await setDoc(photosRef, { data: [] });
                log('âœ… Firebase temizlendi!', 'success');
                localStorage.removeItem('photos_migrated_to_firebase');
            } catch (error) {
                log('âŒ Hata: ' + error.message, 'error');
            }
        });

        // Otomatik test
        setTimeout(async () => {
            log('\nğŸ¯ Otomatik test baÅŸlÄ±yor...');
            document.getElementById('test1').click();
        }, 1000);
    </script>
</body>
</html>
