<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }
        .console {
            background: #0f3460;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: monospace;
        }
        button {
            background: #16213e;
            color: white;
            border: 2px solid #0f3460;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #0f3460;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .info { color: #00bfff; }
    </style>
</head>
<body>
    <h1>🔥 Firebase Bağlantı Testi</h1>
    
    <div>
        <button id="btnTest">1. Firebase Bağlantısını Test Et</button>
        <button id="btnCheck">2. Fotoğrafları Kontrol Et</button>
        <button id="btnUpload">3. Test Verisi Yükle</button>
        <button id="btnClear">4. Firebase'i Temizle</button>
    </div>
    
    <div class="console" id="console">
        <p class="info">📋 Yükleniyor...</p>
    </div>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAsQsyb6VebOmcI9TFsc-IIqXVYFiCwVIo",
            authDomain: "bebegim-5e848.firebaseapp.com",
            projectId: "bebegim-5e848",
            storageBucket: "bebegim-5e848.firebasestorage.app",
            messagingSenderId: "1073954837331",
            appId: "1:1073954837331:web:8fe594a86542966f2147a6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const consoleDiv = document.getElementById('console');
        consoleDiv.innerHTML = '<p class="success">✅ Firebase yüklendi!</p>';

    <script type="module">
        import { FirebaseSync } from './firebase-sync.js';
        
        const firebaseSync = new FirebaseSync();
        window.firebaseSync = firebaseSync;
        
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const p = document.createElement('p');
            p.className = type;
            p.textContent = message;
            console.appendChild(p);
            console.scrollTop = console.scrollHeight;
        }
        
        async function testConnection() {
            log('🔄 Firebase bağlantısı test ediliyor...', 'info');
            try {
                const testData = { test: 'connection', timestamp: new Date().toISOString() };
                const result = await firebaseSync.saveData('test', 'connection', testData);
                
                if (result) {
                    log('✅ Firebase bağlantısı BAŞARILI!', 'success');
                    
                    // Şimdi okumayı test et
                    const readData = await firebaseSync.getData('test', 'connection');
                    if (readData) {
                        log('✅ Firebase okuma BAŞARILI!', 'success');
                        log('📦 Okunan veri: ' + JSON.stringify(readData), 'info');
                    } else {
                        log('❌ Firebase okuma BAŞARISIZ!', 'error');
                    }
                } else {
                    log('❌ Firebase bağlantısı BAŞARISIZ!', 'error');
                }
            } catch (error) {
                log('❌ Hata: ' + error.message, 'error');
                console.error(error);
            }
        }
        
        async function checkPhotos() {
            log('🔄 Fotoğraflar kontrol ediliyor...', 'info');
            try {
                const data = await firebaseSync.getData('photos', 'list');
                log('📦 Firebase\'den dönen veri:', 'info');
                log(JSON.stringify(data, null, 2), 'info');
                
                if (data) {
                    const photos = data.data || data;
                    if (Array.isArray(photos)) {
                        log(`✅ ${photos.length} fotoğraf bulundu!`, 'success');
                        photos.forEach((photo, index) => {
                            log(`  ${index + 1}. ${photo.caption} (${photo.category})`, 'info');
                        });
                    } else {
                        log('⚠️ Fotoğraflar array değil: ' + typeof photos, 'error');
                    }
                } else {
                    log('❌ Firebase\'de fotoğraf bulunamadı!', 'error');
                    
                    // localStorage'ı kontrol et
                    const localPhotos = localStorage.getItem('lovesite_photos');
                    if (localPhotos) {
                        const photos = JSON.parse(localPhotos);
                        log(`📋 localStorage\'da ${photos.length} fotoğraf var`, 'info');
                    } else {
                        log('📋 localStorage\'da da fotoğraf yok', 'info');
                    }
                }
            } catch (error) {
                log('❌ Hata: ' + error.message, 'error');
                console.error(error);
            }
        }
        
        async function uploadTestData() {
            log('🔄 Test verisi yükleniyor...', 'info');
            try {
                const testPhotos = [
                    {
                        id: Date.now(),
                        caption: 'Test Fotoğraf 1',
                        category: 'moments',
                        uploadedAt: new Date().toISOString(),
                        uploadedBy: 'Test User',
                        src: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzY2N2VlYSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1zaXplPSIyMCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iIGZpbGw9IndoaXRlIj5URVNUPC90ZXh0Pjwvc3ZnPg=='
                    }
                ];
                
                const result = await firebaseSync.saveData('photos', 'list', { data: testPhotos });
                
                if (result) {
                    log('✅ Test verisi Firebase\'e yüklendi!', 'success');
                    log('🔄 Şimdi "2. Fotoğrafları Kontrol Et" butonuna basın', 'info');
                } else {
                    log('❌ Test verisi yüklenemedi!', 'error');
                }
            } catch (error) {
                log('❌ Hata: ' + error.message, 'error');
                console.error(error);
            }
        }
        
        async function clearFirebase() {
            if (!confirm('Firebase\'deki tüm fotoğrafları silmek istediğinizden emin misiniz?')) {
                return;
            }
            
            log('🔄 Firebase temizleniyor...', 'info');
            try {
                await firebaseSync.saveData('photos', 'list', { data: [] });
                log('✅ Firebase temizlendi!', 'success');
                localStorage.removeItem('photos_migrated_to_firebase');
                log('📋 Migration flag kaldırıldı', 'info');
            } catch (error) {
                log('❌ Hata: ' + error.message, 'error');
            }
        }
        
        // Event listeners
        document.getElementById('btnTest').addEventListener('click', testConnection);
        document.getElementById('btnCheck').addEventListener('click', checkPhotos);
        document.getElementById('btnUpload').addEventListener('click', uploadTestData);
        document.getElementById('btnClear').addEventListener('click', clearFirebase);
        
        // Sayfa yüklendiğinde otomatik kontrol
        setTimeout(() => {
            log('🚀 Otomatik kontrol başlıyor...', 'info');
            testConnection();
        }, 1000);
    </script>
</body>
</html>
