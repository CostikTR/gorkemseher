<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ FCM HÄ±zlÄ± Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 500px;
            background: rgba(255,255,255,0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            text-align: center;
        }
        button {
            background: white;
            color: #667eea;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
        h1 { font-size: 2.5em; margin-bottom: 10px; }
        .emoji { font-size: 4em; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="emoji">ğŸ””</div>
        <h1>FCM HÄ±zlÄ± Test</h1>
        <p>Firebase Cloud Messaging Testi</p>
        
        <button onclick="quickTest()">âš¡ HÄ±zlÄ± Test</button>
        <button onclick="testToken()">ğŸ”‘ Token Kontrol</button>
        <button onclick="sendTestNotif()">ğŸ“¤ Test Bildirimi</button>
        
        <div class="status" id="status">HazÄ±r... ğŸš€</div>
    </div>

    <script type="module">
        // FCM Manager'Ä± import et
        import { FCMManager } from './fcm-manager.js';
        
        // FCM Manager'Ä± baÅŸlat
        const fcmManager = new FCMManager();
        window.fcmManager = fcmManager;
        
        // FCM'i baÅŸlat
        fcmManager.init().catch(err => {
            console.error('FCM baÅŸlatÄ±lamadÄ±:', err);
        });
        
        const status = document.getElementById('status');

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString('tr-TR');
            const colors = {
                success: '#4ade80',
                error: '#f87171',
                info: '#60a5fa'
            };
            status.innerHTML += `<div style="color: ${colors[type]}">[${time}] ${message}</div>`;
            status.scrollTop = status.scrollHeight;
            console.log(message);
        }

        window.quickTest = async function() {
            status.innerHTML = '';
            log('ğŸš€ HÄ±zlÄ± test baÅŸlatÄ±lÄ±yor...', 'info');
            
            // 1. Notification API
            if (!('Notification' in window)) {
                log('âŒ TarayÄ±cÄ± bildirimleri desteklemiyor!', 'error');
                return;
            }
            log('âœ… Notification API destekleniyor', 'success');
            
            // 2. Service Worker
            if (!('serviceWorker' in navigator)) {
                log('âŒ Service Worker desteklenmiyor!', 'error');
                return;
            }
            log('âœ… Service Worker destekleniyor', 'success');
            
            // 3. HTTPS kontrolÃ¼
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                log('âš ï¸ HTTPS gerekli! (Åu an: ' + location.protocol + ')', 'error');
                return;
            }
            log('âœ… HTTPS aktif', 'success');
            
            // 4. Ä°zin durumu
            log('ğŸ“‹ Ä°zin durumu: ' + Notification.permission, 'info');
            
            if (Notification.permission === 'default') {
                log('â³ Ä°zin isteniyor...', 'info');
                const permission = await Notification.requestPermission();
                log('ğŸ“¢ KullanÄ±cÄ± cevabÄ±: ' + permission, permission === 'granted' ? 'success' : 'error');
            }
            
            if (Notification.permission === 'granted') {
                log('âœ… Bildirim izni var!', 'success');
                
                // 5. Test bildirimi gÃ¶nder
                log('ğŸ“¤ Test bildirimi gÃ¶nderiliyor...', 'info');
                new Notification('ğŸ‰ FCM Testi BaÅŸarÄ±lÄ±!', {
                    body: 'TÃ¼m sistemler Ã§alÄ±ÅŸÄ±yor! Vercel HTTPS aktif! ğŸ’•',
                    icon: '/icon-192.svg',
                    badge: '/badge-72.svg',
                    vibrate: [200, 100, 200, 100, 200]
                });
                log('âœ… Test bildirimi gÃ¶nderildi!', 'success');
            } else {
                log('âŒ Bildirim izni gerekli!', 'error');
            }
            
            // 6. FCM Manager kontrolÃ¼
            setTimeout(() => {
                if (window.fcmManager) {
                    log('âœ… FCM Manager yÃ¼klÃ¼!', 'success');
                    if (window.fcmManager.currentToken) {
                        log('âœ… FCM Token var: ' + window.fcmManager.currentToken.substring(0, 30) + '...', 'success');
                    } else {
                        log('â³ FCM Token alÄ±nÄ±yor...', 'info');
                    }
                } else {
                    log('âš ï¸ FCM Manager henÃ¼z yÃ¼klenmedi. Ana sayfayÄ± aÃ§Ä±n.', 'error');
                }
            }, 2000);
        };

        window.testToken = async function() {
            status.innerHTML = '';
            log('ğŸ”‘ FCM Token kontrol ediliyor...', 'info');
            
            if (!window.fcmManager) {
                log('âŒ FCM Manager yÃ¼klÃ¼ deÄŸil! Ana sayfayÄ± aÃ§Ä±n.', 'error');
                return;
            }
            
            if (window.fcmManager.currentToken) {
                log('âœ… Token mevcut:', 'success');
                log('Token: ' + window.fcmManager.currentToken.substring(0, 50) + '...', 'info');
                log('Uzunluk: ' + window.fcmManager.currentToken.length + ' karakter', 'info');
            } else {
                log('â³ Token alÄ±nÄ±yor...', 'info');
                const token = await window.fcmManager.requestPermissionAndGetToken();
                if (token) {
                    log('âœ… Token alÄ±ndÄ±: ' + token.substring(0, 50) + '...', 'success');
                } else {
                    log('âŒ Token alÄ±namadÄ±! VAPID key kontrol edin.', 'error');
                }
            }
        };

        window.sendTestNotif = async function() {
            status.innerHTML = '';
            log('ğŸ“¤ Test bildirimi hazÄ±rlanÄ±yor...', 'info');
            
            if (Notification.permission !== 'granted') {
                log('âŒ Ã–nce izin verin!', 'error');
                return;
            }
            
            const titles = [
                'ğŸ’• Seni Seviyorum!',
                'ğŸŒŸ Ã–zel Bir AnÄ±',
                'ğŸ‰ Kutlama ZamanÄ±!',
                'ğŸŒˆ Harika Bir GÃ¼n!',
                'âœ¨ Sihirli Bir An'
            ];
            
            const bodies = [
                'Bu bir test bildirimidir ama sen yine de harikasÄ±n! ğŸ’•',
                'FCM sistemi mÃ¼kemmel Ã§alÄ±ÅŸÄ±yor! ğŸš€',
                'Vercel HTTPS ile bildirimler sÃ¼per hÄ±zlÄ±! âš¡',
                'Telefonuna dÃ¼ÅŸen her bildirim bir Ã¶pÃ¼cÃ¼k! ğŸ˜˜',
                'ArtÄ±k WhatsApp gibi gerÃ§ek bildirimler var! ğŸŠ'
            ];
            
            const randomTitle = titles[Math.floor(Math.random() * titles.length)];
            const randomBody = bodies[Math.floor(Math.random() * bodies.length)];
            
            new Notification(randomTitle, {
                body: randomBody,
                icon: '/icon-192.svg',
                badge: '/badge-72.svg',
                vibrate: [300, 100, 300, 100, 300],
                requireInteraction: false,
                tag: 'test-' + Date.now()
            });
            
            log('âœ… Bildirim gÃ¶nderildi!', 'success');
            log('BaÅŸlÄ±k: ' + randomTitle, 'info');
            log('Mesaj: ' + randomBody, 'info');
            
            // FCM push notification (diÄŸer cihazlara)
            if (window.fcmManager) {
                try {
                    log('ğŸ“¡ FCM push notification gÃ¶nderiliyor...', 'info');
                    await window.fcmManager.sendNotificationToUser('shared', {
                        title: randomTitle,
                        body: randomBody,
                        icon: '/icon-192.svg',
                        badge: '/badge-72.svg',
                        data: { url: '/fcm-test.html' }
                    });
                    log('âœ… FCM push notification gÃ¶nderildi!', 'success');
                    log('ğŸ’¡ DiÄŸer cihazlarÄ±nÄ±zÄ± kontrol edin!', 'info');
                } catch (error) {
                    log('âš ï¸ FCM push hatasÄ±: ' + error.message, 'error');
                }
            }
        };

        // Sayfa yÃ¼klendiÄŸinde otomatik kontrol
        window.onload = () => {
            log('ğŸ¯ FCM Test sayfasÄ± yÃ¼klendi!', 'success');
            log('Vercel HTTPS: ' + (location.protocol === 'https:' ? 'âœ…' : 'âŒ'), 
                location.protocol === 'https:' ? 'success' : 'error');
            
            // FCM Manager baÅŸlatma kontrolÃ¼
            setTimeout(() => {
                if (window.fcmManager) {
                    log('âœ… FCM Manager yÃ¼klendi!', 'success');
                } else {
                    log('âš ï¸ FCM Manager yÃ¼klenemedi!', 'error');
                }
            }, 1000);
        };
    </script>
</body>
</html>
